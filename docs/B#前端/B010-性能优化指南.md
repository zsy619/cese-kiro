# æ€§èƒ½ä¼˜åŒ–æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å‰ç«¯é¡¹ç›®çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ©æå‡åº”ç”¨çš„åŠ è½½é€Ÿåº¦ã€è¿è¡Œæ•ˆç‡å’Œç”¨æˆ·ä½“éªŒã€‚

## ğŸ¯ æ€§èƒ½ç›®æ ‡

### Core Web Vitals ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| LCP (Largest Contentful Paint) | < 2.5s | æœ€å¤§å†…å®¹ç»˜åˆ¶æ—¶é—´ |
| FID (First Input Delay) | < 100ms | é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ |
| CLS (Cumulative Layout Shift) | < 0.1 | ç´¯ç§¯å¸ƒå±€åç§» |
| FCP (First Contentful Paint) | < 1.8s | é¦–æ¬¡å†…å®¹ç»˜åˆ¶ |
| TTFB (Time to First Byte) | < 600ms | é¦–å­—èŠ‚æ—¶é—´ |

## ğŸš€ å·²å®ç°çš„ä¼˜åŒ–

### 1. ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

#### React.lazy æ‡’åŠ è½½

```typescript
// App.lazy.tsx
const HomePage = lazy(() => import('./pages/home/HomePage'));
const PromptBuilderPage = lazy(() => import('./pages/generator/PromptBuilderPage'));
const MyTemplatesPage = lazy(() => import('./pages/templates/MyTemplatesPage'));
const APIConfigPage = lazy(() => import('./pages/config/APIConfigPage'));
```

#### è·¯ç”±çº§ä»£ç åˆ†å‰²

```typescript
<Suspense fallback={<PageLoading />}>
    <Routes>
        <Route path='/' element={<HomePage />} />
        <Route path='/generator' element={<PromptBuilderPage />} />
        {/* ... */}
    </Routes>
</Suspense>
```

### 2. é˜²æŠ–å’ŒèŠ‚æµ

#### useDebounce Hook

```typescript
// æœç´¢è¾“å…¥é˜²æŠ–
const debouncedSearchTerm = useDebounce(searchTerm, 300);
```

#### useDebouncedCallback Hook

```typescript
// è‡ªåŠ¨ä¿å­˜é˜²æŠ–
const debouncedSave = useDebouncedCallback(saveData, 1000);
```

#### useThrottle Hook

```typescript
// æ»šåŠ¨äº‹ä»¶èŠ‚æµ
const throttledScroll = useThrottle(scrollPosition, 100);
```

### 3. è‡ªåŠ¨ä¿å­˜ä¼˜åŒ–

```typescript
// useAutoSave Hook
const { isSaving, lastSaved } = useAutoSave(data, saveFunction, {
    delay: 2000,
    enabled: true
});
```

### 4. å“åº”å¼ä¼˜åŒ–

```typescript
// useResponsive Hook
const { isMobile, isTablet, isDesktop } = useResponsive();

// æ ¹æ®è®¾å¤‡ç±»å‹åŠ è½½ä¸åŒç»„ä»¶
{isMobile ? <MobileView /> : <DesktopView />}
```

### 5. æœ¬åœ°å­˜å‚¨ä¼˜åŒ–

```typescript
// useLocalStorage Hook
const [data, setData] = useLocalStorage('key', defaultValue);

// è‡ªåŠ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–
// è‡ªåŠ¨å¤„ç†å­˜å‚¨é”™è¯¯
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–å·¥å…·

### æ€§èƒ½æµ‹é‡

```typescript
import { measurePerformance } from './utils/performance';

measurePerformance('æ•°æ®å¤„ç†', () => {
    // æ‰§è¡Œè€—æ—¶æ“ä½œ
    processData();
});
```

### Web Vitals ç›‘æ§

```typescript
import { getWebVitals } from './utils/performance';

// åœ¨ç”Ÿäº§ç¯å¢ƒç›‘æ§æ€§èƒ½æŒ‡æ ‡
getWebVitals();
```

### ç½‘ç»œçŠ¶æ€æ£€æµ‹

```typescript
import { getNetworkStatus } from './utils/performance';

const status = getNetworkStatus();
console.log('åœ¨çº¿çŠ¶æ€:', status.online);
console.log('ç½‘ç»œç±»å‹:', status.effectiveType);
```

### å†…å­˜ä½¿ç”¨ç›‘æ§

```typescript
import { getMemoryUsage } from './utils/performance';

const memory = getMemoryUsage();
if (memory) {
    console.log('å·²ä½¿ç”¨å†…å­˜:', memory.usedJSHeapSize);
}
```

## ğŸ“¦ æ„å»ºä¼˜åŒ–

### 1. ç”Ÿäº§æ„å»ºé…ç½®

```json
// package.json
{
    "scripts": {
        "build": "react-scripts build",
        "analyze": "source-map-explorer 'build/static/js/*.js'"
    }
}
```

### 2. ç¯å¢ƒå˜é‡ä¼˜åŒ–

```env
# .env.production
GENERATE_SOURCEMAP=false  # ç¦ç”¨ source map
REACT_APP_API_BASE_URL=/api
```

### 3. ä»£ç å‹ç¼©

- JavaScript å‹ç¼©ï¼ˆTerserï¼‰
- CSS å‹ç¼©ï¼ˆcssnanoï¼‰
- HTML å‹ç¼©

## ğŸŒ ç½‘ç»œä¼˜åŒ–

### 1. Nginx é…ç½®

#### Gzip å‹ç¼©

```nginx
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript
           application/x-javascript application/xml+rss
           application/json application/javascript;
```

#### é™æ€èµ„æºç¼“å­˜

```nginx
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

### 2. èµ„æºé¢„åŠ è½½

```typescript
import { preloadResource, preconnect } from './utils/performance';

// é¢„åŠ è½½å…³é”®èµ„æº
preloadResource('/fonts/main.woff2', 'font');

// é¢„è¿æ¥åˆ° API æœåŠ¡å™¨
preconnect('https://api.example.com');
```

### 3. å›¾ç‰‡æ‡’åŠ è½½

```typescript
import { lazyLoadImage } from './utils/performance';

// ä½¿ç”¨ data-src å±æ€§
<img data-src="/path/to/image.jpg" alt="æè¿°" />

// åº”ç”¨æ‡’åŠ è½½
const img = document.querySelector('img');
lazyLoadImage(img);
```

## ğŸ¨ æ¸²æŸ“ä¼˜åŒ–

### 1. React.memo

```typescript
// é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const MemoizedComponent = React.memo(Component, (prevProps, nextProps) => {
    return prevProps.id === nextProps.id;
});
```

### 2. useMemo

```typescript
// ç¼“å­˜è®¡ç®—ç»“æœ
const expensiveValue = useMemo(() => {
    return computeExpensiveValue(a, b);
}, [a, b]);
```

### 3. useCallback

```typescript
// ç¼“å­˜å›è°ƒå‡½æ•°
const handleClick = useCallback(() => {
    doSomething(a, b);
}, [a, b]);
```

### 4. è™šæ‹Ÿæ»šåŠ¨

å¯¹äºé•¿åˆ—è¡¨ï¼Œä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼š

```typescript
import { FixedSizeList } from 'react-window';

<FixedSizeList
    height={600}
    itemCount={1000}
    itemSize={50}
    width="100%"
>
    {Row}
</FixedSizeList>
```

## ğŸ”„ å¼‚æ­¥ä¼˜åŒ–

### 1. æ‰¹é‡å¤„ç†

```typescript
import { batchProcess } from './utils/performance';

// æ‰¹é‡å¤„ç†å¤§é‡æ•°æ®ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹
await batchProcess(items, async (item) => {
    await processItem(item);
}, 10); // æ¯æ‰¹å¤„ç† 10 ä¸ª
```

### 2. ç©ºé—²æ—¶æ‰§è¡Œ

```typescript
import { runWhenIdle } from './utils/performance';

// åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡
runWhenIdle(() => {
    performLowPriorityTask();
}, { timeout: 2000 });
```

### 3. å‡½æ•°è®°å¿†åŒ–

```typescript
import { memoize } from './utils/performance';

// ç¼“å­˜å‡½æ•°ç»“æœ
const expensiveFunction = memoize((a, b) => {
    // è€—æ—¶è®¡ç®—
    return a + b;
});
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### 1. å¼€å‘ç¯å¢ƒç›‘æ§

```typescript
// ä½¿ç”¨ React DevTools Profiler
<Profiler id="App" onRender={onRenderCallback}>
    <App />
</Profiler>
```

### 2. ç”Ÿäº§ç¯å¢ƒç›‘æ§

```typescript
// é›†æˆ Web Vitals
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function sendToAnalytics(metric) {
    // å‘é€åˆ°åˆ†ææœåŠ¡
    console.log(metric);
}

getCLS(sendToAnalytics);
getFID(sendToAnalytics);
getFCP(sendToAnalytics);
getLCP(sendToAnalytics);
getTTFB(sendToAnalytics);
```

## ğŸ¯ ä¼˜åŒ–æ£€æŸ¥æ¸…å•

### ä»£ç å±‚é¢

- [x] ä½¿ç”¨ React.lazy å’Œ Suspense å®ç°ä»£ç åˆ†å‰²
- [x] ä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- [x] ä½¿ç”¨ useMemo å’Œ useCallback ä¼˜åŒ–è®¡ç®—å’Œå›è°ƒ
- [x] å®ç°é˜²æŠ–å’ŒèŠ‚æµ
- [x] ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†é•¿åˆ—è¡¨
- [x] é¿å…åœ¨æ¸²æŸ“ä¸­è¿›è¡Œå¤æ‚è®¡ç®—

### èµ„æºå±‚é¢

- [x] å‹ç¼© JavaScript å’Œ CSS
- [x] ä¼˜åŒ–å›¾ç‰‡ï¼ˆä½¿ç”¨ WebPã€å‹ç¼©ï¼‰
- [x] å®ç°å›¾ç‰‡æ‡’åŠ è½½
- [x] ä½¿ç”¨å­—ä½“å­é›†
- [x] ç§»é™¤æœªä½¿ç”¨çš„ä»£ç 

### ç½‘ç»œå±‚é¢

- [x] å¯ç”¨ Gzip å‹ç¼©
- [x] é…ç½®é™æ€èµ„æºç¼“å­˜
- [x] ä½¿ç”¨ CDNï¼ˆå¯é€‰ï¼‰
- [x] å®ç°èµ„æºé¢„åŠ è½½
- [x] å‡å°‘ HTTP è¯·æ±‚æ•°é‡

### æ„å»ºå±‚é¢

- [x] é…ç½®ç”Ÿäº§ç¯å¢ƒæ„å»º
- [x] ç¦ç”¨ source mapï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [x] ä½¿ç”¨æ„å»ºåˆ†æå·¥å…·
- [x] ä¼˜åŒ–ä¾èµ–åŒ…å¤§å°
- [x] Tree shaking

## ğŸ“ˆ æ€§èƒ½æµ‹è¯•

### ä½¿ç”¨ Lighthouse

```bash
# å®‰è£… Lighthouse
npm install -g lighthouse

# è¿è¡Œæµ‹è¯•
lighthouse http://localhost:3100 --view
```

### ä½¿ç”¨ Chrome DevTools

1. æ‰“å¼€ Chrome DevTools
2. åˆ‡æ¢åˆ° Performance æ ‡ç­¾
3. ç‚¹å‡»å½•åˆ¶æŒ‰é’®
4. æ‰§è¡Œæ“ä½œ
5. åœæ­¢å½•åˆ¶å¹¶åˆ†æç»“æœ

### ä½¿ç”¨ React DevTools Profiler

1. å®‰è£… React DevTools æ‰©å±•
2. æ‰“å¼€ Profiler æ ‡ç­¾
3. ç‚¹å‡»å½•åˆ¶æŒ‰é’®
4. æ‰§è¡Œæ“ä½œ
5. åˆ†æç»„ä»¶æ¸²æŸ“æ€§èƒ½

## ğŸ” æ€§èƒ½é—®é¢˜æ’æŸ¥

### å¸¸è§æ€§èƒ½é—®é¢˜

#### 1. ç»„ä»¶é¢‘ç¹é‡æ¸²æŸ“

**é—®é¢˜**: ç»„ä»¶åœ¨ä¸éœ€è¦æ›´æ–°æ—¶ä¹Ÿé‡æ–°æ¸²æŸ“

**è§£å†³æ–¹æ¡ˆ**:

```typescript
// ä½¿ç”¨ React.memo
const Component = React.memo(MyComponent);

// ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœ
const value = useMemo(() => compute(), [deps]);

// ä½¿ç”¨ useCallback ç¼“å­˜å›è°ƒ
const callback = useCallback(() => {}, [deps]);
```

#### 2. å¤§åˆ—è¡¨æ¸²æŸ“æ…¢

**é—®é¢˜**: æ¸²æŸ“å¤§é‡åˆ—è¡¨é¡¹å¯¼è‡´æ€§èƒ½ä¸‹é™

**è§£å†³æ–¹æ¡ˆ**:

```typescript
// ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
import { FixedSizeList } from 'react-window';
```

#### 3. é¢‘ç¹çš„çŠ¶æ€æ›´æ–°

**é—®é¢˜**: è¾“å…¥æ¡†ç­‰é¢‘ç¹è§¦å‘çŠ¶æ€æ›´æ–°

**è§£å†³æ–¹æ¡ˆ**:

```typescript
// ä½¿ç”¨é˜²æŠ–
const debouncedValue = useDebounce(value, 300);
```

#### 4. å†…å­˜æ³„æ¼

**é—®é¢˜**: ç»„ä»¶å¸è½½åä»æœ‰å®šæ—¶å™¨æˆ–è®¢é˜…

**è§£å†³æ–¹æ¡ˆ**:

```typescript
useEffect(() => {
    const timer = setTimeout(() => {}, 1000);

    return () => {
        clearTimeout(timer); // æ¸…ç†å®šæ—¶å™¨
    };
}, []);
```

## ğŸ“š å‚è€ƒèµ„æº

- [Web Vitals](https://web.dev/vitals/)
- [React Performance Optimization](https://react.dev/learn/render-and-commit)
- [Lighthouse](https://developers.google.com/web/tools/lighthouse)
- [Chrome DevTools](https://developer.chrome.com/docs/devtools/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2024å¹´
**ç»´æŠ¤è€…**: å‰ç«¯å¼€å‘å›¢é˜Ÿ
