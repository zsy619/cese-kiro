# 错误修复记录

## 📋 概述

记录项目开发过程中遇到的错误和修复方案，为后续开发提供参考。

## 🐛 已修复错误

### 1. ESLint 尾随逗号错误

**错误信息**：

```
ERROR[eslint] src/components/common/MonacoEditor.tsx
Line 81:51: Unexpected trailing comma comma-dangle
```

**原因**：

- ESLint 配置禁止尾随逗号
- 数组最后一项后面有逗号

**修复方案**：

```typescript
// ❌ 错误
[/^\d+\.\s.*$/, 'custom-ordered-list'],  // 最后有逗号

// ✅ 正确
[/^\d+\.\s.*$/, 'custom-ordered-list']   // 移除尾随逗号
```

**文件**：`frontend/src/components/common/MonacoEditor.tsx`

### 2. TypeScript 类型不匹配错误

**错误信息**：

```
ERROR in src/components/auth/AuthModal.tsx:289:11
TS2322: Type 'Dispatch<SetStateAction<"login" | "register">>' is not assignable to type '(activeKey: string) => void'.
```

**原因**：

- Ant Design Tabs 的 onChange 期望 `(activeKey: string) => void`
- 但 setActiveTab 的类型是 `Dispatch<SetStateAction<'login' | 'register'>>`
- 类型不完全匹配

**修复方案**：

```typescript
// ❌ 错误
<Tabs
    activeKey={activeTab}
    onChange={setActiveTab}  // 类型不匹配
    items={tabItems}
/>

// ✅ 正确
<Tabs
    activeKey={activeTab}
    onChange={(key) => setActiveTab(key as 'login' | 'register')}  // 类型转换
    items={tabItems}
/>
```

**文件**：`frontend/src/components/auth/AuthModal.tsx`

### 3. Props 不匹配错误

**错误信息**：

```
ERROR in src/components/layout/MainLayout.tsx:283:9
TS2322: Property 'onCancel' does not exist on type 'IntrinsicAttributes & AuthModalProps'.
```

**原因**：

- AuthModal 组件的 Props 定义是 `onClose`
- 但在使用时传递的是 `onCancel`
- Props 名称不一致

**修复方案**：

```typescript
// AuthModal Props 定义
interface AuthModalProps {
    visible: boolean;
    onClose: () => void;  // 使用 onClose
    defaultTab?: 'login' | 'register';
}

// ❌ 错误使用
<AuthModal
    visible={authModalVisible}
    onCancel={() => setAuthModalVisible(false)}  // 错误的 prop 名
    onLogin={handleLoginSubmit}
    onRegister={handleRegisterSubmit}
/>

// ✅ 正确使用
<AuthModal
    visible={authModalVisible}
    onClose={() => setAuthModalVisible(false)}  // 正确的 prop 名
    defaultTab={authModalTab}
/>
```

**文件**：`frontend/src/components/layout/MainLayout.tsx`

## 🔍 待修复错误

### 1. Button 组件类型冲突

**错误信息**：

```
src/components/common/Button.tsx(6,18): error TS2430:
Interface 'ButtonProps' incorrectly extends interface 'Omit<ButtonProps, "type" | "size">'.
Type '"primary"' is not assignable to type '"link" | "text" | "dashed" | "outlined" | "solid" | "filled" | undefined'.
```

**原因**：

- 自定义 ButtonProps 与 Ant Design ButtonProps 的 variant 类型冲突
- 需要重新设计类型定义

**建议修复**：

```typescript
// 方案 1：使用不同的属性名
interface CustomButtonProps {
    buttonVariant?: 'primary' | 'secondary' | 'outline' | 'ghost' | 'link' | 'text';
    // ...
}

// 方案 2：完全自定义，不继承 Ant Design
interface ButtonProps {
    variant?: 'primary' | 'secondary' | 'outline' | 'ghost' | 'link' | 'text';
    size?: 'small' | 'medium' | 'large';
    // ...
}
```

### 2. Card 组件类型冲突

**错误信息**：

```
src/components/common/Card.tsx(8,18): error TS2430:
Type '"default"' is not assignable to type '"outlined" | "borderless" | undefined'.
```

**原因**：

- 类似 Button 组件的问题
- variant 类型与 Ant Design 不兼容

**建议修复**：

```typescript
// 使用不同的属性名
interface CustomCardProps {
    cardVariant?: 'default' | 'bordered' | 'shadow' | 'elevated';
    // ...
}
```

### 3. useDebounce Hook 参数错误

**错误信息**：

```
src/hooks/useDebounce.ts(26,22): error TS2554: Expected 1 arguments, but got 0.
```

**原因**：

- 函数调用缺少必需参数

**建议修复**：

- 检查函数定义和调用
- 确保参数完整

## 📝 修复模式总结

### 1. 类型不匹配

**常见原因**：

- 第三方库类型定义变化
- 自定义类型与库类型冲突
- 类型推导不准确

**修复策略**：

1. 使用类型断言 `as`
2. 使用类型转换函数
3. 重新设计类型定义
4. 使用泛型约束

### 2. Props 不一致

**常见原因**：

- 组件定义和使用不同步
- 重构时遗漏更新
- 命名不统一

**修复策略**：

1. 统一 Props 命名规范
2. 使用 TypeScript 类型检查
3. 及时更新所有使用处
4. 编写单元测试

### 3. ESLint 规则冲突

**常见原因**：

- 代码风格不一致
- 配置规则过严
- 自动格式化冲突

**修复策略**：

1. 统一 ESLint 配置
2. 使用 Prettier 自动格式化
3. 配置 .eslintrc 规则
4. 运行 `npm run lint:fix`

## 🛠️ 预防措施

### 1. 开发阶段

```bash
# 实时类型检查
npm run type-check

# 实时 ESLint 检查
npm run lint

# 保存时自动格式化
# 配置 VS Code: "editor.formatOnSave": true
```

### 2. 提交前检查

```bash
# 运行完整检查
npm run check

# 自动修复
npm run lint:fix
npm run format
```

### 3. CI/CD 集成

```yaml
# .github/workflows/ci.yml
- name: Type Check
  run: npm run type-check

- name: Lint
  run: npm run lint

- name: Format Check
  run: npm run format:check
```

## 📚 参考资源

- [TypeScript 官方文档](https://www.typescriptlang.org/)
- [ESLint 规则](https://eslint.org/docs/rules/)
- [Ant Design TypeScript](https://ant.design/docs/react/use-with-typescript)
- [React TypeScript Cheatsheet](https://react-typescript-cheatsheet.netlify.app/)

## 🔄 更新日志

### 2024-01-01

- ✅ 修复 MonacoEditor 尾随逗号错误
- ✅ 修复 AuthModal 类型不匹配错误
- ✅ 修复 MainLayout Props 不一致错误
- ⏳ Button 组件类型冲突待修复
- ⏳ Card 组件类型冲突待修复
- ⏳ useDebounce Hook 参数错误待修复

---

**维护者**：zsy619
**最后更新**：2024年
